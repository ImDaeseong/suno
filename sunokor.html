<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Suno AI 프롬프트 빌더 (한국어 버전)</title>
    <style>
        /* Base Styles */
        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; background-color: #f4f4f9; color: #333; }
        section { margin-bottom: 25px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h1 { color: #007bff; text-align: center; margin-bottom: 30px; }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-top: 0; }
        
        .checkbox-group { 
            display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; padding: 10px; 
            border: 1px dashed #ccc; border-radius: 5px; max-height: 250px; overflow-y: auto; 
            background-color: #fafafa;
        }

        /* Checkbox Labels (Tag Buttons) - Note: The input is hidden inside the label */
        .checkbox-group label { 
            /* Label is now the visible button */
            background-color: #f0f0f0; color: #6c757d; padding: 8px 14px; border-radius: 25px; 
            cursor: pointer; transition: all 0.2s; font-size: 14px; white-space: nowrap; 
            border: 1px solid #d4d4d4; box-shadow: 0 1px 2px rgba(0,0,0,0.02);
            /* Important: Need to use display: block/inline-block if not using the adjacent selector method correctly */
            display: inline-flex; /* Use inline-flex for better centering if needed */
            align-items: center;
        }

        /* Hide the actual checkbox input */
        .checkbox-group input[type="checkbox"] { display: none; }
        
        /* * FIX/ENHANCEMENT: Use the JavaScript-toggled class for a reliable solution.
         * The original CSS structure often relies on the input and label being adjacent siblings, 
         * but here the input is nested. The following CSS and the JS below fix this.
         */
        
        /* Style for the selected label (using the JS-toggled class on the label itself) */
        .checkbox-group label.checked-label { 
            background-color: #dc3545; 
            color: white; 
            border-color: #c82333; 
            font-weight: bold; 
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.7); 
            transform: scale(1.03); 
        }

        /* If you prefer to stick to the pure CSS method, use a structure where input and label are siblings:
           (We will stick to the nested structure and use JS for safety) 
        */


        /* Common Input/Select Style */
        input[type="text"], select { 
            padding: 8px; border: 1px solid #ccc; border-radius: 5px; margin-right: 5px; 
            box-sizing: border-box; display: inline-block;
        }
        select { margin-bottom: 5px; }
        
        button { 
            padding: 12px 25px; background-color: #007bff; color: white; border: none; 
            border-radius: 5px; cursor: pointer; margin-top: 20px; font-size: 16px; 
            font-weight: bold; transition: background-color 0.3s; display: block; width: 100%;
        }
        button:hover { background-color: #0056b3; }
        
        textarea { 
            width: 100%; padding: 15px; border: 2px solid #007bff; border-radius: 5px; 
            box-sizing: border-box; margin-top: 10px; font-family: Consolas, monospace; font-size: 14px; 
            background-color: #f8f9fa; 
        }
        
        .category-title { font-weight: bold; margin-top: 15px; display: block; color: #007bff; font-size: 15px; padding-left: 5px; }
        hr { border: 0; height: 1px; background-color: #ccc; margin: 20px 0; }
        .output-section h2 { color: #dc3545; border-bottom: 2px solid #dc3545; }

        /* Section Detail Styles */
        #section-details-container {
            margin-top: 15px; padding: 15px; border: 1px solid #f0ad4e; border-radius: 5px; background-color: #fff9f3;
        }
        .section-detail {
            margin-bottom: 15px; padding: 10px; border-left: 5px solid #d9534f; background-color: #fff; border-radius: 3px;
        }
        .section-detail label {
            font-weight: bold; display: block; margin-bottom: 8px; color: #d9534f; border-bottom: 1px dotted #f0ad4e; padding-bottom: 3px;
            font-size: 14px;
        }
        .detail-row {
            display: flex; gap: 10px; flex-wrap: wrap; margin-top: 5px; margin-bottom: 10px;
        }
        .detail-row select {
            flex-grow: 1; min-width: 120px; margin-right: 0;
        }
        
        /* Instrument Multi-select Area Styles */
        .instrument-multiselect {
            margin-top: 10px;
            padding: 8px;
            border: 1px dashed #c0c0c0;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .instrument-multiselect h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #555;
            border-bottom: 1px dotted #ccc;
            padding-bottom: 3px;
        }
        .instrument-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 5px;
        }
        .instrument-list label {
            font-weight: normal;
            color: #333;
            margin-right: 5px;
            display: inline-block;
            border-bottom: none; 
            padding-bottom: 0;
            cursor: pointer;
            font-size: 13px;
            background-color: transparent; /* Override button style for nested labels */
            border: none;
            padding: 0;
            box-shadow: none;
        }
        .instrument-list label.checked-label {
            /* Highlight for nested instrument labels */
            font-weight: bold;
            color: #dc3545;
            text-decoration: underline;
            transform: none; /* No scale for nested labels */
            box-shadow: none;
        }
    </style>
</head>
<body>

    <h1>✨ Suno AI 프롬프트 빌더 ✨</h1>
    
    <section id="style-selection">
        <h2>1. ? 전체 음악 스타일 모듈 (Style of Music)</h2>
        <span class="category-title">⭐ 장르 & 스타일 태그:</span>
        <div class="checkbox-group">
            <label><input type="checkbox" name="genre" value="팝"> 팝</label>
            <label><input type="checkbox" name="genre" value="록"> 록</label>
            <label><input type="checkbox" name="genre" value="힙합"> 힙합</label>
            <label><input type="checkbox" name="genre" value="일렉트로닉"> 일렉트로닉</label>
            <label><input type="checkbox" name="genre" value="재즈"> 재즈</label>
            <label><input type="checkbox" name="genre" value="클래식"> 클래식</label>
            <label><input type="checkbox" name="genre" value="포크"> 포크</label>
            <label><input type="checkbox" name="genre" value="R&B"> R&B</label>
            <label><input type="checkbox" name="genre" value="컨트리"> 컨트리</label>
            <label><input type="checkbox" name="genre" value="레게"> 레게</label>
            <label><input type="checkbox" name="genre" value="트로트"> 트로트</label>
            
            <label><input type="checkbox" name="subgenre_electronic" value="하우스"> 하우스</label>
            <label><input type="checkbox" name="subgenre_electronic" value="테크노"> 테크노</label>
            <label><input type="checkbox" name="subgenre_electronic" value="앰비언트"> 앰비언트</label>
            <label><input type="checkbox" name="subgenre_electronic" value="덥스텝"> 덥스텝</label>
            <label><input type="checkbox" name="subgenre_electronic" value="트랜스"> 트랜스</label>

            <label><input type="checkbox" name="subgenre_rock" value="얼터너티브 록"> 얼터너티브 록</label>
            <label><input type="checkbox" name="subgenre_rock" value="하드 록"> 하드 록</label>
            <label><input type="checkbox" name="subgenre_rock" value="인디 록"> 인디 록</label>
            <label><input type="checkbox" name="subgenre_rock" value="프로그레시브 록"> 프로그레시브 록</label>

            <label><input type="checkbox" name="subgenre_hybrid" value="인디 포크"> 인디 포크</label>
            <label><input type="checkbox" name="subgenre_hybrid" value="재즈 퓨전"> 재즈 퓨전</label>
            <label><input type="checkbox" name="subgenre_hybrid" value="일렉트로 스윙"> 일렉트로 스윙</label>
            <label><input type="checkbox" name="subgenre_hybrid" value="트립 합"> 트립 합</label>
            <label><input type="checkbox" name="subgenre_hybrid" value="시네마틱 팝"> 시네마틱 팝</label>
            <label><input type="checkbox" name="subgenre_niche" value="고스"> 고스</label>
            <label><input type="checkbox" name="subgenre_niche" value="슈게이징"> 슈게이징</label>
            <label><input type="checkbox" name="subgenre_niche" value="스토너 록"> 스토너 록</label>
            <label><input type="checkbox" name="subgenre_niche" value="스카 펑크"> 스카 펑크</label>
            <label><input type="checkbox" name="subgenre_niche" value="글리치 합"> 글리치 합</label>
            <label><input type="checkbox" name="subgenre_niche" value="퓨처 베이스"> 퓨처 베이스</label>
        </div>
        
        <hr>

        <span class="category-title">?️ 시대별 & ? 지역별 스타일:</span>
        <div class="checkbox-group">
            <label><input type="checkbox" name="era" value="80년대 신스웨이브"> 80년대 신스웨이브</label>
            <label><input type="checkbox" name="era" value="90년대 그런지"> 90년대 그런지</label>
            <label><input type="checkbox" name="era" value="70년대 펑크"> 70년대 펑크</label>
            <label><input type="checkbox" name="era" value="Y2K 팝"> Y2K 팝</label>
            <label><input type="checkbox" name="era" value="빅 밴드 시대"> 빅 밴드 시대</label>
            <label><input type="checkbox" name="regional" value="아프로비트"> 아프로비트</label>
            <label><input type="checkbox" name="regional" value="라틴 재즈"> 라틴 재즈</label>
            <label><input type="checkbox" name="regional" value="보사노바"> 보사노바</label>
            <label><input type="checkbox" name="regional" value="살사"> 살사</label>
            <label><input type="checkbox" name="regional" value="가스펠"> 가스펠</label>
            <label><input type="checkbox" name="regional" value="볼리우드"> 볼리우드</label>
            <label><input type="checkbox" name="regional" value="스카"> 스카</label>
            <label><input type="checkbox" name="regional" value="켈틱 포크"> 켈틱 포크</label>
            <label><input type="checkbox" name="regional" value="클레즈머 음악"> 클레즈머 음악</label>
        </div>

        <hr>

        <span class="category-title">? 감정적 무드 & ? 분위기/에너지 태그:</span>
        <div class="checkbox-group">
            <label><input type="checkbox" name="energy_intensity_overall" value="고에너지"> 고에너지</label>
            <label><input type="checkbox" name="energy_intensity_overall" value="저에너지"> 저에너지</label>
            <label><input type="checkbox" name="energy_intensity_overall" value="강렬한"> 강렬한</label>
            <label><input type="checkbox" name="energy_intensity_overall" value="잔잔한"> 잔잔한</label>
            <label><input type="checkbox" name="energy_intensity_overall" value="웅장한"> 웅장한</label>
            <label><input type="checkbox" name="energy_intensity_overall" value="역동적인"> 역동적인</label>

            <label><input type="checkbox" name="mood_overall" value="멜랑콜리"> 멜랑콜리</label>
            <label><input type="checkbox" name="mood_overall" value="유포릭"> 유포릭</label>
            <label><input type="checkbox" name="mood_overall" value="향수 어린"> 향수 어린</label>
            <label><input type="checkbox" name="mood_overall" value="몽환적인"> 몽환적인</label>
            <label><input type="checkbox" name="mood_overall" value="공격적인"> 공격적인</label>
            <label><input type="checkbox" name="mood_overall" value="평화로운"> 평화로운</label>
            <label><input type="checkbox" name="mood_overall" value="신비로운"> 신비로운</label>
            
            <label><input type="checkbox" name="texture_fx" value="로파이"> 로파이</label>
            <label><input type="checkbox" name="texture_fx" value="바이닐 노이즈"> 바이닐 노이즈</label>
            <label><input type="checkbox" name="texture_fx" value="테이프 새츄레이션"> 테이프 새츄레이션</label>
            <label><input type="checkbox" name="texture_fx" value="공간감 있는"> 공간감 있는</label>
            <label><input type="checkbox" name="texture_fx" value="리버브가 강한"> 리버브가 강한</label>
            <label><input type="checkbox" name="texture_fx" value="디스토션"> 디스토션</label>
            <label><input type="checkbox" name="texture_fx" value="아날로그"> 아날로그</label>
            <label><input type="checkbox" name="texture_fx" value="따뜻한 믹스"> 따뜻한 믹스</label>
            <label><input type="checkbox" name="texture_fx" value="크리스탈 클리어"> 크리스탈 클리어</label>
            <label><input type="checkbox" name="texture_fx" value="드라이 믹스"> 드라이 믹스</label>
            <label><input type="checkbox" name="texture_fx" value="선명한"> 선명한</label>
        </div>

        <hr>
        
        <span class="category-title">? 보컬 성별/유형 및 BPM 선택:</span>
        <div style="display: flex; gap: 10px; margin-top: 15px; margin-bottom: 15px;">
            <select id="overallVocalGender">
                <option value="">-- 보컬 성별/유형 (선택 사항) --</option>
                <option value="남성 보컬">남성 보컬</option>
                <option value="여성 보컬">여성 보컬</option>
                <option value="어린이 보컬">어린이 보컬</option>
                <option value="듀엣 보컬">듀엣 보컬</option>
                <option value="화음">화음</option>
                <option value="합창단">합창단</option>
                <option value="보컬 없음">보컬 없음</option>
            </select>
            
            <input type="text" id="overallBpm" placeholder="정확한 BPM 값 (예: 110)">
        </div>

        <span class="category-title">?️ 추가 보컬 스타일/테크닉/특징:</span>
        <div class="checkbox-group">
            <label><input type="checkbox" name="vocal_style_overall" value="파워풀한 보컬"> 파워풀한 보컬</label>
            <label><input type="checkbox" name="vocal_style_overall" value="속삭이는 보컬"> 속삭이는 보컬</label>
            <label><input type="checkbox" name="vocal_style_overall" value="부드러운 보컬"> 부드러운 보컬</label>
            <label><input type="checkbox" name="vocal_style_overall" value="거친 목소리"> 거친 목소리</label>
            <label><input type="checkbox" name="vocal_style_overall" value="맑은 목소리"> 맑은 목소리</label>
            <label><input type="checkbox" name="vocal_style_overall" value="저음"> 저음</label>
            <label><input type="checkbox" name="vocal_style_overall" value="고음"> 고음</label>
            <label><input type="checkbox" name="vocal_style_overall" value="소울풀한 목소리"> 소울풀한 목소리</label>

            <label><input type="checkbox" name="vocal_style_overall" value="가성"> 가성</label>
            <label><input type="checkbox" name="vocal_style_overall" value="비브라토"> 비브라토</label>
            <label><input type="checkbox" name="vocal_style_overall" value="멜리스마"> 멜리스마</label>
            <label><input type="checkbox" name="vocal_style_overall" value="스타카토 보컬"> 스타카토 보컬</label>
            <label><input type="checkbox" name="vocal_style_overall" value="레가토 보컬"> 레가토 보컬</label>
            <label><input type="checkbox" name="vocal_style_overall" value="애드립"> 애드립</label>
            <label><input type="checkbox" name="vocal_style_overall" value="샤우팅"> 샤우팅</label>
            <label><input type="checkbox" name="vocal_style_overall" value="스캣 싱잉"> 스캣 싱잉</label>
            <label><input type="checkbox" name="vocal_style_overall" value="요들"> 요들</label>
        </div>

    </section>

    <hr>
    
    <section>
        <h2>2. ? 곡 구조 및 섹션 상세 설정 모듈</h2>
        <span class="category-title">원하는 곡 구조 템플릿 선택 (필수):</span>
        <select id="structureType" onchange="updateSectionDetails(this.value);">
            <option value="">-- 구조 유형을 선택하세요 --</option>
            <optgroup label="--- ? 팝 음악 구조 ---">
                <option value="StandardPop">표준 팝 (Verse-Chorus-Bridge)</option>
                <option value="HookFocusPop">훅 강조 팝 (코러스 먼저 시작)</option>
                <option value="KPopDance">K-Pop/댄스 팝 (댄스 브레이크 포함)</option>
            </optgroup>
            <optgroup label="--- ? 록 음악 구조 ---">
                <option value="ClassicRock">클래식 록 (기타 솔로 포함)</option>
                <option value="AlternativeGrunge">얼터너티브/그런지 (Soft-Loud 대비)</option>
                <option value="ProgressiveRock">프로그레시브 록 (복잡한 간주)</option>
            </optgroup>
            <optgroup label="--- ? 힙합/R&B 구조 ---">
                <option value="StandardHipHop">표준 힙합 (Verse-Hook)</option>
                <option value="R&BSoul">R&B/소울 (애드립, 화음)</option>
                <option value="TrapStreet">트랩/스트릿 (비트 드롭 강조)</option>
            </optgroup>
            <optgroup label="--- ? EDM/댄스 음악 구조 ---">
                <option value="HouseTechno">하우스/테크노 (빌드업 & 드롭)</option>
                <option value="TranceDubstep">트랜스/덥스텝 (클라이맥스 드롭)</option>
                <option value="LoFiAmbient">로파이/앰비언트 (반복 루프)</option>
            </optgroup>
            <optgroup label="--- ? 재즈/블루스 구조 ---">
                <option value="StandardBlues">표준 블루스 (12마디, 즉흥 솔로)</option>
                <option value="JazzStandard">재즈 스탠더드 (AABA 형식)</option>
            </optgroup>
            <optgroup label="--- ? 시네마틱/클래식 구조 ---">
                <option value="CinematicScore">시네마틱 스코어 (긴장 & 클라이맥스)</option>
                <option value="ModernClassical">현대 클래식 (악장 구분)</option>
            </optgroup>
             <optgroup label="--- ? 트로트 구조 확장 ---">
                <option value="StandardTrot">표준 트로트 (간주 브레이크)</option>
                <option value="DanceTrot">댄스 트로트</option>
                <option value="SlowTrot">슬로우 트로트 (감성 발라드형)</option>
            </optgroup>
             <optgroup label="--- ? 발라드 구조 확장 ---">
                <option value="PowerBallad">파워 발라드 (전조, 최대 파워)</option>
                <option value="R&BBallad">R&B 발라드 (보컬 하모니, 색소폰/로즈 간주)</option>
                <option value="AcousticBallad">어쿠스틱 발라드 (단순, Verse 3)</option>
            </optgroup>
            <optgroup label="--- ? 포크/컨트리/레게 구조 ---">
                <option value="StandardFolk">표준 포크 (Verse 3 간주)</option>
                <option value="BluegrassIrish">블루그래스/아이리시 (빠른 솔로, 브레이크다운)</option>
                <option value="NarrativeCountry">내러티브 컨트리 (페달 스틸, 긴 이야기)</option>
                <option value="StandardReggae">표준 레게 (덥 브레이크, 토스팅)</option>
            </optgroup>

        </select>
        <p id="structureDesc" style="margin-top: 5px; color: #555;">선택된 구조 특징: 구조 유형을 선택해 주세요.</p>

        <span class="category-title" style="margin-top: 15px;">? 섹션별 스타일 상세 설정 (콤보박스 + 다중 선택)</span>
        <div id="section-details-container">
            <p style="color: #a94442;">구조 유형을 선택하면 각 주요 섹션별 BPM, 무드, 악기, 보컬 톤 설정 필드가 나타납니다.</p>
        </div>
    </section>

    <button onclick="generatePrompt()">최종 프롬프트 생성 및 업데이트</button>

    <hr>
    
    <section class="output-section">
        <h2>결과 1: 음악 스타일 태그</h2>
        <textarea id="outputStyle" rows="5" readonly placeholder="곡 전체에 적용될 핵심 스타일 태그가 여기에 표시됩니다."></textarea>
        
        <h2>결과 2: 가사 템플릿</h2>
        <textarea id="outputLyrics" rows="20" placeholder="섹션별 BPM/무드 태그가 적용된 최종 가사 구조가 여기에 표시됩니다. 앵글 브라켓(< >) 안에 가사 내용을 직접 채워 넣으세요."></textarea>
        
        <p style="color: #dc3545; font-weight: bold; margin-top: 10px;">*사용 방법: 결과 1을 Suno의 Style(스타일) 필드에, 결과 2를 Lyrics(가사) 필드에 복사하여 사용하세요.</p>
    </section>

    <script>
        // C. [NEW] Function to ensure real-time checkbox visual feedback
        function setupCheckboxVisuals() {
            // Select all input type="checkbox" elements
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                // Initial check for pre-selected items (if any, though none are here)
                if (checkbox.checked) {
                    checkbox.parentElement.classList.add('checked-label');
                } else {
                    checkbox.parentElement.classList.remove('checked-label');
                }

                // Add change listener for real-time update
                checkbox.addEventListener('change', (event) => {
                    // event.target is the input checkbox
                    const label = event.target.parentElement;
                    if (event.target.checked) {
                        label.classList.add('checked-label');
                    } else {
                        label.classList.remove('checked-label');
                    }

                    // Re-generate prompt to reflect current selections in the output
                    generatePrompt();
                });
            });
        }
        
        // A. Section Combobox Options Data (Updated and Translated)
        const detailOptions = {
            tempo: [
                { value: '', label: '1. -- BPM/템포 (선택) --' },
                { value: 'BPM 80', label: 'BPM 80 (느림)' },
                { value: 'BPM 110', label: 'BPM 110 (중간)' },
                { value: 'BPM 140', label: 'BPM 140 (빠름)' },
                { value: 'BPM 180', label: 'BPM 180 (매우 빠름)' },
                { value: '느린 템포', label: '느린 템포 (60-80 BPM)' },
                { value: '중간 템포', label: '중간 템포 (90-120 BPM)' },
                { value: '빠른 템포', label: '빠른 템포 (130-180 BPM)' },
                { value: '매우 빠름', label: '매우 빠름 (180+ BPM)' },
                { value: '더블 타임 필', label: '더블 타임 필' },
                { value: '하프 타임 필', label: '하프 타임 필' },
            ],
            // **[UPDATE]: Mood, Rhythm, Groove, Time Signature Tags Consolidated**
            rhythmAndMood: [
                { value: '', label: '2. -- 리듬/박자/무드 (선택) --' },
                
                // Time Signatures
                { value: '4/4 박자', label: '4/4 박자 (표준 박자)' },
                { value: '3/4 박자', label: '3/4 박자 (왈츠 박자)' },
                { value: '6/8 박자', label: '6/8 박자 (복합 박자)' },
                { value: '5/4 박자', label: '5/4 박자 (변칙 박자)' },

                // Rhythmic Feels
                { value: '스트레이트 필', label: '스트레이트 필' },
                { value: '스윙 필', label: '스윙 필 (재즈/스윙)' },
                { value: '셔플 필', label: '셔플 필' },
                { value: '라틴 필', label: '라틴 필 (싱코페이션)' },

                // Groove Types
                { value: '백비트', label: '백비트 (2/4 박자 강조)' },
                { value: '오프비트', label: '오프비트 (약박 강조, 레게)' },
                { value: '폴리리듬', label: '폴리리듬' },
                { value: '크로스 리듬', label: '크로스 리듬' },

                // Energy and Intensity Tags
                { value: '고에너지', label: '고에너지' },
                { value: '저에너지', label: '저에너지' },
                { value: '에너지 상승', label: '에너지 상승' },
                { value: '강렬한', label: '강렬한' },
                { value: '잔잔한', label: '잔잔한' },
                { value: '역동적인', label: '역동적인' },

                // Emotional Mood Tags
                { value: '멜랑콜리', label: '멜랑콜리' }, 
                { value: '유포릭', label: '유포릭' }, 
                { value: '향수 어린', label: '향수 어린' }, 
                { value: '몽환적인', label: '몽환적인' }, 
                { value: '공격적인', label: '공격적인' }, 
                { value: '평화로운', label: '평화로운' }, 
                { value: '신비로운', label: '신비로운' }, 
                { value: '극적인', label: '극적인' },

                // Performance/Mixing Details 
                { value: '타이트한 드럼', label: '타이트한 드럼' },
                { value: '스윙 비트', label: '스윙 비트' },
                { value: '워킹 베이스라인', label: '워킹 베이스라인' },
                { value: '드라이 믹스', label: '드라이 믹스 (리버브 없음)' },
                { value: '도시 거리 효과음', label: '도시 거리 효과음' }
            ],
            // **[UPDATE]: Vocal Style, Technique, Character Tags Consolidated**
            vocal: [
                { value: '', label: '3. -- 보컬 톤/테크닉 (선택) --' },
                // Styles
                { value: '파워풀한 보컬', label: '파워풀한 보컬' },
                { value: '속삭이는 보컬', label: '속삭이는 보컬' },
                { value: '부드러운 보컬', label: '부드러운 보컬' },
                { value: '화음', label: '화음' },
                { value: '합창단', label: '합창단' },
                // Techniques
                { value: '가성', label: '가성' },
                { value: '비브라토', label: '비브라토' },
                { value: '멜리스마', label: '멜리스마' },
                { value: '스타카토 보컬', label: '스타카토 보컬' },
                { value: '레가토 보컬', label: '레가토 보컬' },
                // Character and Action
                { value: '거친 목소리', label: '거친 목소리' },
                { value: '맑은 목소리', label: '맑은 목소리' },
                { value: '저음', label: '저음' },
                { value: '고음', label: '고음' },
                { value: '소울풀한 목소리', label: '소울풀한 목소리' },
                { value: '애드립', label: '애드립' },
                { value: '샤우팅', label: '샤우팅' },
                { value: '스캣 싱잉', label: '스캣 싱잉' },
                { value: '요들', label: '요들' }
            ],
            // Instrument Categories (Expanded to include traditional instruments)
            instrumentCategories: {
                // Melody, Harmony (Keys, Strings, Brass/Woodwind)
                melodyHarmony: [
                    { value: '피아노', label: '피아노' },
                    { value: '일렉트릭 피아노', label: '일렉트릭 피아노' },
                    { value: '신시사이저', label: '신시사이저' },
                    { value: '오르간', label: '오르간' },
                    { value: '스트링 섹션', label: '스트링 섹션' },
                    { value: '일렉트릭 기타', label: '일렉트릭 기타' },
                    { value: '어쿠스틱 기타', label: '어쿠스틱 기타' },
                    { value: '바이올린', label: '바이올린' },
                    { value: '첼로', label: '첼로' },
                    { value: '색소폰', label: '색소폰' },
                    { value: '트럼펫', label: '트럼펫' },
                    { value: '플루트', label: '플루트' },
                    { value: '클라리넷', label: '클라리넷' }
                ],
                // Rhythm, Bass, Percussion
                rhythm: [
                    { value: '베이스 기타', label: '베이스 기타' },
                    { value: '808 베이스', label: '808 베이스' },
                    { value: '드럼', label: '풀 드럼 키트' },
                    { value: '일렉트로닉 드럼', label: '일렉트로닉 드럼' },
                    { value: '핸드 퍼커션', label: '핸드 퍼커션' },
                    { value: '장구', label: '장구 (한국 전통)' },
                    { value: '타이코 드럼', label: '타이코 드럼' },
                    { value: '타블라', label: '타블라' },
                    { value: '젬베', label: '젬베' },
                    { value: '슬랩 베이스', label: '슬랩 베이스' }
                ],
                // Special and Regional Instruments
                specialRegion: [
                    { value: '가야금', label: '가야금 (한국 전통)' },
                    { value: '해금', label: '해금 (한국 전통)' },
                    { value: '대금', label: '대금 (한국 전통)' },
                    { value: '샤쿠하치', label: '샤쿠하치 (일본 전통)' },
                    { value: '고토', label: '고토 (일본 전통)' },
                    { value: '시타르', label: '시타르' },
                    { value: '페달 스틸 기타', label: '페달 스틸 기타' }
                ],
                // Sound Effects and Texture (Including FX/Texture)
                fxTexture: [
                    { value: '디스토션 기타', label: '디스토션 기타' },
                    { value: '리버브 FX', label: '리버브 FX' },
                    { value: '에코 딜레이', label: '에코 딜레이' },
                    { value: '스크래칭', label: '스크래칭 (DJ)' },
                    { value: '필터드 스윕', label: '필터드 스윕' },
                    { value: '아르페지에이터', label: '아르페지에이터' },
                    { value: '사운드스케이프', label: '사운드스케이프' },
                    { value: '바이닐 노이즈', label: '바이닐 노이즈' },
                    { value: '빗소리 효과음', label: '빗소리 효과음' },
                    { value: '카페 소음 효과음', label: '카페 소음 효과음' }
                ]
            }
        };

        // B. Structure Details and Template Data (Translated)
        const structureData = {
            "StandardPop": {
                desc: "가장 기본적이고 성공적인 구조. [Bridge]에서 긴장을 고조시킨 후 마지막 폭발적인 코러스로 이어집니다.",
                sections: ['Intro', 'Verse 1', 'Pre-Chorus', 'Chorus', 'Verse 2', 'Pre-Chorus', 'Chorus', 'Bridge', 'Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (저에너지)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (중간 에너지)\n<1절 가사 4줄>',
                    'Pre-Chorus': '[프리 코러스] (에너지 상승)\n<프리 코러스 가사 2줄>',
                    'Chorus': '[코러스] (고에너지)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지)\n<2절 가사 4줄>',
                    'Bridge': '[브릿지] (잔잔, 무드 전환)\n<브릿지 가사 2줄>',
                    'Outro': '[아웃트로] (페이드 아웃)\n<아웃트로 가사 한 줄>'
                }
            },
            "HookFocusPop": {
                desc: "도입부 직후 코러스(훅)를 제시하여 청중을 즉시 사로잡습니다.",
                sections: ['Intro', 'Chorus', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (짧은 훅 모티브)\n<도입 가사 한 줄>',
                    'Chorus': '[코러스] (고에너지)\n<코러스 가사 4줄>',
                    'Verse 1': '[1절] (중간 에너지, 섬세함)\n<1절 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지)\n<2절 가사 4줄>',
                    'Outro': '[아웃트로] (저에너지, 보컬 애드립, 페이드 아웃)\n<아웃트로 가사 한 줄>'
                }
            },
            "KPopDance": {
                desc: "[Post-Chorus]와 [Dance Break]를 통해 리듬과 무드 변화를 강조하는 복잡한 구조입니다.",
                sections: ['Intro', 'Verse 1', 'Pre-Chorus', 'Chorus', 'Post-Chorus', 'Verse 2', 'Pre-Chorus', 'Chorus', 'Dance Break', 'Bridge', 'Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (저에너지, 신스 라이저)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (중간 에너지)\n<1절 가사 3줄>',
                    'Pre-Chorus': '[프리 코러스] (에너지 상승, 긴장감)\n<프리 코러스 가사 2줄>',
                    'Chorus': '[코러스] (고에너지)\n<코러스 가사 4줄>',
                    'Post-Chorus': '[포스트 코러스] (폭발적 에너지, 리듬 전환)\n<포스트 코러스 가사 2줄>',
                    'Verse 2': '[2절] (중간 에너지, 랩 중점)\n<2절 랩 가사 3줄>',
                    'Dance Break': '[댄스 브레이크] (강렬한, 헤비 비트, 보컬 없음)',
                    'Bridge': '[브릿지] (잔잔, 무드 전환)\n<브릿지 가사 2줄>',
                    'Outro': '[아웃트로] (고에너지, FX 페이드)\n<아웃트로 가사 한 줄>'
                }
            },
            "ClassicRock": {
                desc: "코러스와 브릿지 사이에 솔로 파트를 배치하여 곡의 중심을 잡아줍니다.",
                sections: ['Intro', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Guitar Solo', 'Bridge', 'Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (중간 에너지, 기타 리프)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (중간 에너지)\n<1절 가사 4줄>',
                    'Chorus': '[코러스] (고에너지, 웅장한)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지)\n<2절 가사 4줄>',
                    'Guitar Solo': '[기타 솔로] (강렬한, 디스토션, 하모닉 마이너)',
                    'Bridge': '[브릿지] (잔잔, 새로운 코드 진행)\n<브릿지 가사 2줄>',
                    'Outro': '[아웃트로] (고에너지, 드럼 필인)\n<아웃트로 가사 한 줄>'
                }
            },
            "AlternativeGrunge": {
                desc: "극도의 Soft/Loud 다이내믹 대비를 통해 감정 폭발을 표현합니다.",
                sections: ['Intro', 'Verse 1 (Soft)', 'Chorus (Loud)', 'Verse 2 (Soft)', 'Chorus (Loud)', 'Bridge (Quiet)', 'Climactic Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (저에너지, 조용한 기타)',
                    'Verse 1 (Soft)': '[1절] (저에너지, 속삭이는 보컬)\n<1절 가사 4줄>',
                    'Chorus (Loud)': '[코러스] (고에너지, 디스토션 기타, 샤우팅)\n<코러스 가사 4줄>',
                    'Verse 2 (Soft)': '[2절] (저에너지, 섬세한 드럼)\n<2절 가사 4줄>',
                    'Bridge (Quiet)': '[브릿지] (매우 저에너지, 멜랑콜리)\n<브릿지 가사 2줄>',
                    'Climactic Chorus': '[코러스] (최대 에너지, 풀 파워, 공격적인)\n<코러스 가사 4줄>',
                    'Outro': '[아웃트로] (노이즈 페이드, 피드백)\n<아웃트로 가사 한 줄>'
                }
            },
            "ProgressiveRock": {
                desc: "기악 파트가 많은 복잡하고 긴 구조로, [Complex Interlude]가 특징입니다.",
                sections: ['Intro (Ambient)', 'Verse 1', 'Chorus', 'Complex Interlude', 'Verse 2', 'Chorus', 'Bridge (Time Change)', 'Outro (Instrumental Finish)'],
                template: {
                    'Intro (Ambient)': '[도입] (신비로운, 공간감 있는, 긴)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (중간 템포, 역동적인)\n<1절 가사 6줄>',
                    'Chorus': '[코러스] (고에너지, 웅장한)\n<코러스 가사 4줄>',
                    'Complex Interlude': '[간주] (7/8 박자, 강렬한, 신스 솔로, 폴리리듬)',
                    'Verse 2': '[2절] (중간 템포, 스토리텔링)\n<2절 가사 6줄>',
                    'Bridge (Time Change)': '[브릿지] (왈츠 박자, 잔잔, 무드 전환)\n<브릿지 가사 3줄>',
                    'Outro (Instrumental Finish)': '[아웃트로] (기악 페이드, 스트링 섹션)\n<아웃트로 가사 한 줄>'
                }
            },
            "StandardHipHop": {
                desc: "벌스 이후 [Hook](코러스)이 반복되는 표준적인 힙합 구조입니다.",
                sections: ['Intro', 'Verse 1', 'Hook', 'Verse 2', 'Hook', 'Outro'],
                template: {
                    'Intro': '[도입] (저에너지, 짧은 비트)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (중간 에너지, 랩)\n<1절 랩 가사 4줄>',
                    'Hook': '[훅] (고에너지, 중독성 있는)\n<훅 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지, 랩)\n<2절 랩 가사 4줄>',
                    'Outro': '[아웃트로] (페이드 아웃)\n<아웃트로 가사 한 줄>'
                }
            },
            "R&BSoul": {
                desc: "보컬 퍼포먼스와 하모니에 중점을 둔 부드러운 R&B 구조로, [Rhodes/Sax Interlude]가 특징입니다.",
                sections: ['Intro (Smooth)', 'Verse 1', 'Pre-Chorus', 'Chorus', 'Verse 2', 'Chorus', 'Rhodes/Sax Interlude', 'Bridge', 'Chorus (Ad-libs)', 'Outro (Vocal Run)'],
                template: {
                    'Intro (Smooth)': '[도입] (부드러운, 일렉트릭 피아노)\n<도입 가사 한 줄>',
                    'Verse 1': '[1절] (잔잔, 소울풀한 보컬)\n<1절 가사 4줄>',
                    'Pre-Chorus': '[프리 코러스] (고조, 화음)\n<프리 코러스 가사 2줄>',
                    'Chorus': '[코러스] (중간 에너지, 풍성한)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (잔잔, 깊은 베이스라인)\n<2절 가사 4줄>',
                    'Rhodes/Sax Interlude': '[간주] (색소폰 솔로, 로즈 피아노)',
                    'Bridge': '[브릿지] (멜리스마, 전조)\n<브릿지 가사 2줄>',
                    'Chorus (Ad-libs)': '[코러스] (고에너지, 애드립, 합창단)\n<코러스 가사 4줄>',
                    'Outro (Vocal Run)': '[아웃트로] (보컬 런, 페이드 아웃)\n<아웃트로 가사 한 줄>'
                }
            },
            "TrapStreet": {
                desc: "헤비한 비트와 베이스, 멜로디 변화는 최소화하고 비트 드롭을 강조합니다.",
                sections: ['Intro (Beat Setup)', 'Verse 1 (Fast Rap)', 'Hook', 'Verse 2 (Slow Rap)', 'Beat Drop/Breakdown', 'Hook', 'Outro (808 Bass Finish)'],
                template: {
                    'Intro (Beat Setup)': '[도입] (808 베이스, 하이햇)\n<도입 가사 한 줄>',
                    'Verse 1 (Fast Rap)': '[1절] (빠른 랩, 강렬한)\n<1절 랩 가사 4줄>',
                    'Hook': '[훅] (고에너지, 애드립)\n<훅 가사 4줄>',
                    'Verse 2 (Slow Rap)': '[2절] (느린 플로우, 어두운 무드)\n<2절 랩 가사 4줄>',
                    'Beat Drop/Breakdown': '[브레이크다운] (최대 강렬함, 필터드 808, 보컬 없음)',
                    'Outro (808 Bass Finish)': '[아웃트로] (808 베이스, 페이드 아웃)\n<아웃트로 가사 한 줄>'
                }
            },
            "HouseTechno": {
                desc: "빌드업과 드롭 구조를 가진 댄스 트랙입니다.",
                sections: ['Intro (Beat Start)', 'Build-up 1', 'Drop 1', 'Breakdown 1', 'Build-up 2', 'Drop 2', 'Outro (Fade Out)'],
                template: {
                    'Intro (Beat Start)': '[도입] (4/4 비트, 신스 리프)',
                    'Build-up 1': '[빌드업] (필터 스윕, 라이저 FX, 에너지 상승)',
                    'Drop 1': '[드롭] (고에너지, 헤비 킥, 베이스라인)',
                    'Breakdown 1': '[브레이크다운] (중간 에너지, 앰비언트 패드, 필터 FX)',
                    'Build-up 2': '[빌드업] (강렬한, 스네어 롤)',
                    'Drop 2': '[드롭] (클라이맥스, 스타카토 신스)',
                    'Outro (Fade Out)': '[아웃트로] (비트 페이드, 에코 딜레이)'
                }
            },
            "TranceDubstep": {
                desc: "멜로디 라인과 클라이맥스 드롭에 중점을 둡니다.",
                sections: ['Intro (Ambient Pad)', 'Phrase 1', 'Build-up', 'Climactic Drop', 'Breakdown (Melodic)', 'Outro (Reverberant)'],
                template: {
                    'Intro (Ambient Pad)': '[도입] (공간감 있는, 몽환적인)',
                    'Phrase 1': '[구절 1] (중간 템포, 아르페지에이터)',
                    'Build-up': '[빌드업] (강렬한, 스네어 롤, 하이패스 필터)',
                    'Climactic Drop': '[드롭] (워블 베이스, 최대 볼륨, 유포릭)',
                    'Breakdown (Melodic)': '[브레이크다운] (멜랑콜리, 피아노 코드, 잔잔)',
                    'Outro (Reverberant)': '[아웃트로] (리버브가 강한, 신스 패드, 페이드 아웃)'
                }
            },
            "LoFiAmbient": {
                desc: "끊김 없이 반복되는 평화로운 구조입니다.",
                sections: ['Loop A (Quiet)', 'Loop B (Dynamic)', 'Loop A (Quiet)', 'Outro (Vinyl Hiss)'],
                template: {
                    'Loop A (Quiet)': '[루프 A] (로파이, 바이닐 노이즈, 조용한 드럼)',
                    'Loop B (Dynamic)': '[루프 B] (약간 역동적인, 첼로 멜로디, 맑은 믹스)',
                    'Outro (Vinyl Hiss)': '[아웃트로] (페이드 아웃, 빗소리 효과음)'
                }
            },
            "StandardBlues": {
                desc: "즉흥 연주가 포함된 고전적인 12마디 블루스 구조입니다.",
                sections: ['Intro', 'Chorus 1 (12-Bar)', 'Chorus 2 (12-Bar)', 'Harmonica/Guitar Solo (12-Bar)', 'Chorus 3 (12-Bar)', 'Outro'],
                template: {
                    'Intro': '[도입] (블루스 스케일, 저에너지)',
                    'Chorus 1 (12-Bar)': '[코러스 1] (셔플 필, 거친 목소리)\n<코러스 가사 3줄>',
                    'Chorus 2 (12-Bar)': '[코러스 2] (셔플 필, 워킹 베이스라인)\n<코러스 가사 3줄>',
                    'Harmonica/Guitar Solo (12-Bar)': '[솔로] (즉흥 연주, 디스토션 기타)',
                    'Chorus 3 (12-Bar)': '[코러스 3] (파워풀한 보컬)\n<코러스 가사 3줄>',
                    'Outro': '[아웃트로] (피아노 코드, 페이드 아웃)'
                }
            },
            "JazzStandard": {
                desc: "악기 솔로 브레이크가 있는 고전적인 AABA 형식입니다.",
                sections: ['Intro', 'A Section', 'A Section', 'B Section (Bridge)', 'A Section', 'Solo Break', 'A Section', 'Outro'],
                template: {
                    'Intro': '[도입] (스윙 필, 피아노 코드)',
                    'A Section': '[A 섹션] (중간 템포, 스윙 필, 부드러운 보컬)\n<A 섹션 가사 4줄>',
                    'B Section (Bridge)': '[B 섹션] (무드 전환, 잔잔, 새로운 코드 진행)\n<B 섹션 가사 4줄>',
                    'Solo Break': '[솔로 브레이크] (색소폰 솔로, 스캣 싱잉)',
                    'Outro': '[아웃트로] (페이드 아웃, 클라리넷 솔로)'
                }
            },
            "CinematicScore": {
                desc: "긴장감 조성과 클라이맥스 해소에 중점을 둔 오케스트라 곡입니다.",
                sections: ['Overture (Gentle)', 'Tension Build-up (Staccato)', 'Climax (Powerful)', 'Resolution (Peaceful)'],
                template: {
                    'Overture (Gentle)': '[서곡] (스트링 섹션, 평화로운, 느린 템포)',
                    'Tension Build-up (Staccato)': '[고조] (스타카토, 타이코 드럼, 에너지 상승)',
                    'Climax (Powerful)': '[클라이맥스] (최대 강렬함, 브라스 섹션, 웅장한 합창단)',
                    'Resolution (Peaceful)': '[해결] (플루트 멜로디, 평화로운, 페이드 아웃)'
                }
            },
            "ModernClassical": {
                desc: "보컬 파트보다는 악장의 움직임에 중점을 둡니다.",
                sections: ['Movement I (Slow)', 'Movement II (Fast)', 'Movement III (Climactic)', 'Coda'],
                template: {
                    'Movement I (Slow)': '[1악장] (첼로 솔로, 멜랑콜리, 3/4 박자)',
                    'Movement II (Fast)': '[2악장] (빠른 템포, 바이올린, 역동적인)',
                    'Movement III (Climactic)': '[3악장] (브라스 섹션, 웅장한, 극적인)',
                    'Coda': '[코다] (피아노, 잔잔하게 페이드 아웃)'
                }
            },
            "StandardTrot": {
                desc: "밝고 에너지 넘치는 한국 트로트 구조에 간주 브레이크가 있습니다.",
                sections: ['Intro', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Instrumental Break', 'Chorus', 'Outro'],
                template: {
                    'Intro': '[도입] (고에너지, 브라스 섹션)',
                    'Verse 1': '[1절] (중간 템포, 트로트 필)\n<1절 가사 4줄>',
                    'Chorus': '[코러스] (고에너지, 풀 오케스트라)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (중간 템포, 더 감성적인)\n<2절 가사 4줄>',
                    'Instrumental Break': '[브레이크] (색소폰 솔로, 신나는 드럼)',
                    'Outro': '[아웃트로] (페이드 아웃, 애드립)'
                }
            },
            "DanceTrot": {
                desc: "강한 일렉트로닉 및 댄스 요소가 가미된 신나는 트로트 스타일입니다.",
                sections: ['Intro (Synth Beat)', 'Verse 1', 'Pre-Chorus', 'Chorus (Explosive)', 'Dance Break (Electronic)', 'Verse 2', 'Chorus', 'Outro'],
                template: {
                    'Intro (Synth Beat)': '[도입] (일렉트로닉 드럼, 신스 베이스)',
                    'Verse 1': '[1절] (중간-빠른 템포, 스타카토 보컬)\n<1절 가사 4줄>',
                    'Pre-Chorus': '[프리 코러스] (에너지 상승, 라이저 FX)\n<프리 코러스 가사 2줄>',
                    'Chorus (Explosive)': '[코러스] (최대 에너지, 덥스텝 영향)\n<코러스 가사 4줄>',
                    'Dance Break (Electronic)': '[브레이크] (강렬한, 필터드 스윕, 보컬 없음)',
                    'Verse 2': '[2절] (중간-빠른 템포, 랩 스타일)\n<2절 가사 4줄>',
                    'Outro': '[아웃트로] (신스 리프 페이드 아웃)'
                }
            },
            "SlowTrot": {
                desc: "파워풀하고 소울풀한 보컬에 중점을 둔 감성적인 트로트 발라드입니다.",
                sections: ['Intro (Piano/Strings)', 'Verse 1 (Quiet)', 'Chorus (Emotional)', 'Verse 2 (Building)', 'Climactic Chorus', 'Bridge (Key Change)', 'Final Chorus', 'Outro'],
                template: {
                    'Intro (Piano/Strings)': '[도입] (피아노, 스트링 섹션, 멜랑콜리)',
                    'Verse 1 (Quiet)': '[1절] (느린 템포, 맑은 목소리)\n<1절 가사 4줄>',
                    'Chorus (Emotional)': '[코러스] (파워풀한 보컬, 극적인)\n<코러스 가사 4줄>',
                    'Verse 2 (Building)': '[2절] (에너지 상승, 저음)\n<2절 가사 4줄>',
                    'Climactic Chorus': '[코러스] (최대 강렬함, 풀 밴드)\n<코러스 가사 4줄>',
                    'Bridge (Key Change)': '[브릿지] (전조, 가성, 비브라토)\n<브릿지 가사 2줄>',
                    'Final Chorus': '[코러스] (폭발적인, 고음)\n<코러스 가사 4줄>',
                    'Outro': '[아웃트로] (페이드 아웃, 보컬 런)'
                }
            },
            "PowerBallad": {
                desc: "최종 전조를 통해 최대 강렬함에 도달하는 고출력 발라드 구조입니다.",
                sections: ['Intro (Piano)', 'Verse 1 (Soft)', 'Pre-Chorus', 'Chorus', 'Verse 2', 'Chorus', 'Guitar Solo (Melodic)', 'Bridge (Key Change)', 'Climactic Chorus', 'Outro (High Note)'],
                template: {
                    'Intro (Piano)': '[도입] (피아노, 잔잔)',
                    'Verse 1 (Soft)': '[1절] (저에너지, 부드러운 보컬)\n<1절 가사 4줄>',
                    'Pre-Chorus': '[프리 코러스] (에너지 상승, 스트링)\n<프리 코러스 가사 2줄>',
                    'Chorus': '[코러스] (고에너지, 파워풀한 보컬)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지, 드럼 진입)\n<2절 가사 4줄>',
                    'Guitar Solo (Melodic)': '[솔로] (멜로딕 기타 솔로, 리버브 FX)',
                    'Bridge (Key Change)': '[브릿지] (무드 전환, 전조, 잔잔)\n<브릿지 가사 2줄>',
                    'Climactic Chorus': '[코러스] (최대 파워, 합창단, 샤우팅)\n<코러스 가사 4줄>',
                    'Outro (High Note)': '[아웃트로] (페이드 아웃, 고음 지속)'
                }
            },
            "R&BBallad": {
                desc: "하모니와 부드러운 기악 간주에 중점을 둔 로맨틱 R&B 발라드입니다.",
                sections: ['Intro (Rhodes)', 'Verse 1', 'Chorus (Harmony)', 'Verse 2', 'Chorus', 'Sax Interlude', 'Bridge (Ad-libs)', 'Chorus (Ad-libs)', 'Outro (Vocal Run)'],
                template: {
                    'Intro (Rhodes)': '[도입] (일렉트릭 피아노, 부드러운)',
                    'Verse 1': '[1절] (잔잔, 속삭이는 보컬)\n<1절 가사 4줄>',
                    'Chorus (Harmony)': '[코러스] (중간 에너지, 화음, 풍성한 믹스)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (중간 에너지, 라이트 드럼)\n<2절 가사 4줄>',
                    'Sax Interlude': '[간주] (색소폰 솔로, 소울풀)',
                    'Bridge (Ad-libs)': '[브릿지] (에너지 상승, 애드립)\n<브릿지 가사 2줄>',
                    'Chorus (Ad-libs)': '[코러스] (고에너지, 비브라토, 멜리스마)\n<코러스 가사 4줄>',
                    'Outro (Vocal Run)': '[아웃트로] (보컬 런, 페이드 아웃)'
                }
            },
            "AcousticBallad": {
                desc: "주로 기타/피아노와 보컬이 주도하는 단순하고 내성적인 발라드 구조입니다.",
                sections: ['Intro (Acoustic)', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Verse 3 (New Lyric)', 'Outro (Instrumental)'],
                template: {
                    'Intro (Acoustic)': '[도입] (어쿠스틱 기타, 잔잔)',
                    'Verse 1': '[1절] (느린 템포, 맑은 목소리)\n<1절 가사 4줄>',
                    'Chorus': '[코러스] (중간 에너지, 단순한 드럼)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (느린 템포, 스토리텔링)\n<2절 가사 4줄>',
                    'Verse 3 (New Lyric)': '[3절] (약간 고조, 새로운 화음)\n<3절 가사 4줄>',
                    'Outro (Instrumental)': '[아웃트로] (어쿠스틱 기타, 평화롭게 페이드 아웃)'
                }
            },
            "StandardFolk": {
                desc: "스토리텔링에 중점을 두며, 단순한 벌스-코러스 구조에 중심 간주가 있습니다.",
                sections: ['Intro', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Interlude (Banjo/Fiddle)', 'Verse 3', 'Outro'],
                template: {
                    'Intro': '[도입] (어쿠스틱 기타, 포크 필)',
                    'Verse 1': '[1절] (스토리텔링, 맑은 목소리)\n<1절 가사 4줄>',
                    'Chorus': '[코러스] (중간 에너지, 화음)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (스토리텔링, 단순함)\n<2절 가사 4줄>',
                    'Interlude (Banjo/Fiddle)': '[간주] (피들 솔로, 블루그래스 템포)',
                    'Verse 3': '[3절] (감성적인, 고조)\n<3절 가사 4줄>',
                    'Outro': '[아웃트로] (페이드 아웃, 하모니카 솔로)'
                }
            },
            "BluegrassIrish": {
                desc: "빠르고 에너지 넘치며, 춤을 위한 기악 중심 구조입니다.",
                sections: ['Intro', 'Instrumental A (Fast)', 'Breakdown (Quiet)', 'Instrumental B (Climactic)', 'Instrumental A (Repeat)', 'Outro'],
                template: {
                    'Intro': '[도입] (빠른 템포, 바이올린)',
                    'Instrumental A (Fast)': '[기악 A] (매우 빠름, 만돌린, 밴조 솔로)',
                    'Breakdown (Quiet)': '[브레이크다운] (하프 타임 필, 잔잔한 플루트, 조용한 드럼)',
                    'Instrumental B (Climactic)': '[기악 B] (최대 강렬함, 고음 요들)',
                    'Instrumental A (Repeat)': '[기악 A] (반복, 풀 파워)',
                    'Outro': '[아웃트로] (웅장한 코드로 마무리)'
                }
            },
            "NarrativeCountry": {
                desc: "스토리에 초점을 맞춘 컨트리 음악으로, 종종 페달 스틸과 긴 구조를 사용합니다.",
                sections: ['Intro (Pedal Steel)', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Verse 3 (New Story)', 'Pedal Steel Solo', 'Outro'],
                template: {
                    'Intro (Pedal Steel)': '[도입] (페달 스틸 기타, 향수 어린)',
                    'Verse 1': '[1절] (스토리텔링, 거친 목소리)\n<1절 가사 6줄>',
                    'Chorus': '[코러스] (중간 템포, 백비트)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (스토리텔링, 더 깊은)\n<2절 가사 6줄>',
                    'Verse 3 (New Story)': '[3절] (감정적 클라이맥스, 고조)\n<3절 가사 6줄>',
                    'Pedal Steel Solo': '[솔로] (페달 스틸 기타 솔로, 멜랑콜리)',
                    'Outro': '[아웃트로] (페이드 아웃, 기타 리프)'
                }
            },
            "StandardReggae": {
                desc: "오프비트 강조의 레게 리듬에 덥 브레이크가 포함된 구조입니다.",
                sections: ['Intro (Bassline)', 'Verse 1', 'Chorus', 'Verse 2', 'Chorus', 'Dub Break', 'Toasting Verse', 'Outro'],
                template: {
                    'Intro (Bassline)': '[도입] (오프비트, 베이스 기타, 저에너지)',
                    'Verse 1': '[1절] (중간 템포, 부드러운 보컬)\n<1절 가사 4줄>',
                    'Chorus': '[코러스] (중간 에너지, 오프비트)\n<코러스 가사 4줄>',
                    'Verse 2': '[2절] (스토리텔링, 잔잔)\n<2절 가사 4줄>',
                    'Dub Break': '[브레이크] (리버브 FX, 에코 딜레이, 덥 믹스)',
                    'Toasting Verse': '[3절] (토스팅/랩, 역동적인)\n<토스팅 가사 4줄>',
                    'Outro': '[아웃트로] (페이드 아웃, 에코 딜레이)'
                }
            }
        };

        // Global variable to store current section details
        let currentSectionDetails = {};
        
        // --- Core Functions ---

        // Function to create an HTML option element
        function createOption(value, text) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            return option;
        }

        // Function to create a combobox/select element
        function createSelect(idPrefix, sectionName, options) {
            const select = document.createElement('select');
            select.id = `${idPrefix}-${sectionName}`;
            select.name = select.id;
            select.onchange = generatePrompt; // Trigger prompt regeneration on change

            options.forEach(optionData => {
                select.appendChild(createOption(optionData.value, optionData.label));
            });

            return select;
        }
        
        // Function to create a checkbox input and its label (for instruments)
        function createInstrumentCheckbox(sectionName, category, instrument) {
            const container = document.createElement('label');
            
            // Create checkbox
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.name = `instrument-${sectionName}-${category}`;
            input.value = instrument.value;
            input.id = `inst-${sectionName}-${instrument.value.replace(/\s/g, '-')}`;
            
            // Attach real-time visual and prompt generation listeners
            input.addEventListener('change', (event) => {
                // Toggle checked-label class on the parent label
                event.target.parentElement.classList.toggle('checked-label', event.target.checked);
                // Trigger prompt generation
                generatePrompt();
            });

            // Set initial state
            if (currentSectionDetails[sectionName] && 
                currentSectionDetails[sectionName].instruments && 
                currentSectionDetails[sectionName].instruments.includes(instrument.value)) {
                input.checked = true;
                container.classList.add('checked-label');
            }

            container.appendChild(input);
            container.appendChild(document.createTextNode(instrument.label)); // Text node for the instrument name
            
            return container;
        }

        // Function to generate the Instrument Multiselect Area
        function createInstrumentArea(sectionName) {
            const container = document.createElement('div');
            container.className = 'instrument-multiselect';
            
            const title = document.createElement('h4');
            title.textContent = '4. ? 악기 태그 (관련된 모든 항목 선택)';
            container.appendChild(title);

            // Function to generate a list of instruments for a category
            function generateInstrumentList(titleText, instruments) {
                const categoryTitle = document.createElement('p');
                categoryTitle.innerHTML = `<strong>${titleText}:</strong>`;
                container.appendChild(categoryTitle);
                
                const list = document.createElement('div');
                list.className = 'instrument-list';
                
                instruments.forEach(instrument => {
                    list.appendChild(createInstrumentCheckbox(sectionName, titleText.replace(/\s/g, ''), instrument));
                });
                container.appendChild(list);
            }
            
            generateInstrumentList('건반/현악기/관악기', detailOptions.instrumentCategories.melodyHarmony);
            generateInstrumentList('리듬/퍼커션', detailOptions.instrumentCategories.rhythm);
            generateInstrumentList('특수/지역 악기', detailOptions.instrumentCategories.specialRegion);
            generateInstrumentList('FX/텍스처', detailOptions.instrumentCategories.fxTexture);

            return container;
        }

        // Main function to update the structure details section
        function updateSectionDetails(structureKey) {
            const container = document.getElementById('section-details-container');
            const desc = document.getElementById('structureDesc');
            container.innerHTML = '';
            currentSectionDetails = {}; // Reset details

            if (!structureKey) {
                desc.textContent = "선택된 구조 특징: 구조 유형을 선택해 주세요.";
                return;
            }

            const data = structureData[structureKey];
            desc.textContent = `선택된 구조 특징: ${data.desc}`;

            data.sections.forEach(sectionName => {
                // Initialize details for this section
                currentSectionDetails[sectionName] = {
                    tempo: '',
                    rhythmAndMood: '',
                    vocal: '',
                    instruments: []
                };

                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-detail';
                sectionDiv.id = `detail-${sectionName.replace(/\s/g, '-')}`;

                const titleLabel = document.createElement('label');
                titleLabel.textContent = `▶️ 섹션: ${sectionName}`;
                sectionDiv.appendChild(titleLabel);

                const detailRow = document.createElement('div');
                detailRow.className = 'detail-row';

                // 1. Tempo/BPM Select
                detailRow.appendChild(createSelect('tempo', sectionName, detailOptions.tempo));
                
                // 2. Rhythm/Mood Select
                detailRow.appendChild(createSelect('rhythmMood', sectionName, detailOptions.rhythmAndMood));
                
                // 3. Vocal Tone Select
                detailRow.appendChild(createSelect('vocalTone', sectionName, detailOptions.vocal));
                
                sectionDiv.appendChild(detailRow);
                
                // 4. Instrument Multiselect Area
                sectionDiv.appendChild(createInstrumentArea(sectionName));
                
                container.appendChild(sectionDiv);
            });
            
            // Trigger an initial prompt update after loading the sections
            generatePrompt();
        }


        // Function to collect data and generate the final prompt
        function generatePrompt() {
            // --- Result 1: Style of Music Tags ---
            const overallTags = [];
            
            // 1. Checkbox groups
            document.querySelectorAll('#style-selection .checkbox-group input[type="checkbox"]:checked').forEach(input => {
                overallTags.push(input.value);
            });

            // 2. Selects/Inputs
            const vocalGender = document.getElementById('overallVocalGender').value;
            if (vocalGender) overallTags.push(vocalGender);
            
            const bpmValue = document.getElementById('overallBpm').value.trim();
            if (bpmValue) overallTags.push(`BPM ${bpmValue}`);

            document.getElementById('outputStyle').value = overallTags.join(', ');


            // --- Result 2: Lyrics Template with Section Tags ---
            const structureKey = document.getElementById('structureType').value;
            let lyricsOutput = '';
            
            if (structureKey && structureData[structureKey]) {
                const data = structureData[structureKey];
                const sections = data.sections;
                const template = data.template;
                
                const finalLyricsArray = [];

                sections.forEach(sectionName => {
                    const baseTemplate = template[sectionName];
                    if (!baseTemplate) return;

                    let baseTag = baseTemplate.match(/\[(.*?)\]/)[0]; // e.g., [1절]
                    let existingTags = baseTemplate.substring(baseTag.length).trim(); // e.g., (중간 에너지)

                    // Remove surrounding parenthesis if empty
                    if (existingTags.startsWith('(') && existingTags.endsWith(')')) {
                        existingTags = existingTags.substring(1, existingTags.length - 1).trim();
                    }

                    const sectionTags = [];

                    // 1. Collect Combobox tags (Tempo, Rhythm/Mood, Vocal)
                    const tempo = document.getElementById(`tempo-${sectionName}`).value;
                    const rhythmMood = document.getElementById(`rhythmMood-${sectionName}`).value;
                    const vocalTone = document.getElementById(`vocalTone-${sectionName}`).value;

                    if (tempo) sectionTags.push(tempo);
                    if (rhythmMood) sectionTags.push(rhythmMood);
                    if (vocalTone) sectionTags.push(vocalTone);

                    // 2. Collect Instrument Checkbox tags
                    const instrumentInputs = document.querySelectorAll(`input[name^="instrument-${sectionName}-"]:checked`);
                    instrumentInputs.forEach(input => {
                        sectionTags.push(input.value);
                    });
                    
                    // Combine all tags: existing tags from template + new custom tags
                    const allTags = [existingTags, ...sectionTags].filter(tag => tag.trim() !== '').join(', ');

                    // Reconstruct the line
                    const newTagString = allTags ? `(${allTags.trim()})` : '';
                    
                    // Find the split point: the first newline character
                    const splitIndex = baseTemplate.indexOf('\n');
                    
                    if (splitIndex !== -1) {
                        // If template has both tag line and placeholder lyric line
                        const lyricLine = baseTemplate.substring(splitIndex + 1);
                        finalLyricsArray.push(`${baseTag} ${newTagString}`.trim());
                        finalLyricsArray.push(lyricLine);
                    } else {
                        // If template only has a tag line (e.g., Dance Break)
                        finalLyricsArray.push(`${baseTag} ${newTagString}`.trim());
                    }
                });

                lyricsOutput = finalLyricsArray.join('\n\n');
            }

            document.getElementById('outputLyrics').value = lyricsOutput;
        }

        // D. Initial setup and listeners when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            setupCheckboxVisuals(); // [NEW] Initialize visual state for checkboxes
            
            // Add change listener to the structure dropdown (already has onchange attribute, but for completeness)
            document.getElementById('structureType').addEventListener('change', generatePrompt);

            // Add input listeners for the overall BPM input
            document.getElementById('overallBpm').addEventListener('input', generatePrompt);
            document.getElementById('overallVocalGender').addEventListener('change', generatePrompt);
            
            // Initial call to update sections/prompt (in case default structure is set)
            updateSectionDetails(document.getElementById('structureType').value);
        });

    </script>
</body>
</html>
